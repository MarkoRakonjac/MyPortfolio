{% assign product_out_of_campaign = false %}
{% if  settings.show_out_of_campaign %}
{% for tag in product.tags %}
    {% if tag == settings.out_of_campaign_tag %}
        {% assign product_out_of_campaign = true %}
    {% endif %}
{% endfor %}
{% endif %}
<div class="grid-view-item js-ajax-add-to-cart" data-id="{{ product.id }}">
  <div class="grid-view-item-image">

    {% if  product.media.size > 1 %}
      <div class="reveal">
    {% endif %}

    <a href="{{ product.url | within: collection }}" title="{{product.title}}" class="grid__image grid__image__match">
      {% assign image = product.media[0].preview_image %}
      {% capture props %}
         style="max-width: {{ image.width }}px"
      {% endcapture %}
      {% include 'responsive-image' with image, alt: image.alt, props: props %}

      {% if  product.media.size > 1 %}
        <div class="hidden">
          {% assign image = product.media[1].preview_image %}
          {% capture props %}
            style="max-width: {{ image.width }}px"
          {% endcapture %}
          {% include 'responsive-image' with image, alt: image.alt, props: props %}
        </div>
      {% endif %}
        {% if product_out_of_campaign and settings.show_out_of_campaign %}
            <div class="sold-out-wrap"></div>
        {% else %}
            {% if settings.enable-sold-out-badge  and product.available== false %}
                <div class="sold-out-wrap"></div>
            {% endif %}
        {% endif %}
    </a>

    {% if product.media.size > 1 %}
      </div>
    {% endif %}


    {% if section.settings.quick_shop_enable %}
      <div class="shop-now-wrapper">
        <a class="shop-now-button" href="{{ product.url | within: collection }}">{{ 'products.product.quick_shop' | t }}</a>
      </div>
    {% endif %}

  </div>

  <div class="grid-view-item--desc-wrapper">
    <div>
      {% if section.settings.show-vendor %}
        <div class="product-grid--vendor-text">{{ product.vendor }}</div>
      {% endif %}
      <p class="product-grid--title">
        <a href="{{ product.url | within: collection }}">{{ product.title }}</a>
      </p>
      <p class="product-grid--price">
        {% include 'product-grid-item-price' %}
      </p>

    </div>
  </div>
    {% assign packAvaliable = true %}
    {% assign isPack = false %}
    {% if product.type == "pack" %}
        {% assign isPack = true %}
        {% for field in product.metafields.products %}
            {% assign fieldName = field | first %}
            {% if fieldName contains "Handle" %}
                {% assign fieldHandle = field | last %}
                {%- assign productPro = all_products[fieldHandle] -%}
                {% assign fieldId = fieldName | replace: "-Handle" , "" %}
                {% for variantPro in productPro.variants %}
                    {% assign varId = variantPro.id | append:  "" %}
                    {% if varId == fieldId %}
                        {% unless variantPro.available %}
                        {% assign packAvaliable = false %}
                        {% endunless %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endfor %}
    {% endif %}
    {% assign formId ="AddToCartForm-" | append :  product.id  %}
    {% form 'product', product, id: formId %}
        <input type="hidden" name="quantity" value="1"/>
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}"/>
        {% if product.metafields.products["Tax percentage"] == blank  or  shop.taxes_included %}
        {% else %}
            {% assign iva = product.metafields.products["Tax percentage"] | replace : "%", "" %}
            <input type="hidden" name="properties[iva]" value="{{ iva }}">
        {% endif %}
        {% include "pack-properties" %}
        <div class="product-grid__btn-holder">
            {% if  product_out_of_campaign %}
                <a href="{{ product.url | within: collection }}" class="btn product-grid__btn ">
                    {{ 'products.product.more_info' | t }}
                </a>
            {% else %}
                {% if isPack == true and packAvaliable == false %}
                    <a href="{{ product.url | within: collection }}" class="btn product-grid__btn ">
                        {{ 'products.product.more_info' | t }}
                    </a>
                {% else %}
                    {% if product.available %}
                        {% if product.has_only_default_variant %}
                            <button type="submit" name="add" id="AddToCart-{{ product.id }}"
                                    data-use-ajax="true"
                                    class="btn product-grid__btn loader__wrapper">
                                <span class="loader"></span>
                                <span class="loader__text"
                                      id="AddToCartText-{{ product.id }}">{{ 'products.product.add_to_cart' | t }}</span>
                            </button>
                        {% else %}
                            <a href="{{ product.url | within: collection }}" class="btn product-grid__btn">
                                {{ 'products.product.select_option' | t }}
                            </a>
                        {% endif %}
                    {% else %}
                        <a href="{{ product.url | within: collection }}" class="btn product-grid__btn ">
                            {{ 'products.product.more_info' | t }}
                        </a>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
    {% endform %}

    {% if product_out_of_campaign and settings.show_out_of_campaign %}
        <div class="sold-out-badge badge out-of-campaign--collection-label">{{ 'products.product.out_of_campaign' | t }}</div>
    {% else %}
        {% if isPack == true and packAvaliable == false %}
            <div class="sold-out-badge badge sold-out--collection-label">{{ 'products.product.sold_out' | t }}</div>
        {% else %}
            {% if settings.enable-sold-out-badge  and product.available== false %}
                <div class="sold-out-badge badge sold-out--collection-label">{{ 'products.product.sold_out' | t }}</div>
            {% else %}
                {% if product.compare_at_price_max > product.price and product.available and settings.enable-sale-badge %}
                    <div class="sale-badge badge on-sale--collection-label">{{ 'products.product.on_sale' | t }}</div>
                {% endif %}
            {% endif %}
        {% endif %}
    {% endif %}
</div>
